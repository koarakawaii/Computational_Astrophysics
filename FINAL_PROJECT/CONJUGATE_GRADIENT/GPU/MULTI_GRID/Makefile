CUDIR     := /usr/local/cuda
GSLDIR	  := /usr/local/gsl
OPENBLASDIR := /usr/local/openblas

CC      := gcc
CFLAGS  := -O3 -Wall -g
CPP     := g++
CFLAGS  := -O3 -Wall -g
NVCC    := $(CUDIR)/bin/nvcc
NVFLAGS := -O3 --compiler-options -fopenmp -I$(CUDIR)/include -I$(GSLDIR)/include -m64 -arch=compute_75 -code=sm_75 -Xptxas -v

BIN     := CONJUGATE_GRADIENT_SOLVER_MULTI_GRID CONJUGATE_GRADIENT_SOLVER_TWO_GRID CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_MIXED CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_FULL_V_MIXED
FILE_MGCG    := CONJUGATE_GRADIENT_SOLVER_MULTI_GRID.cu 
#FILE_MGCG_SSOR	:= CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_SSOR.cu
FILE_MGCG_MIXED := CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_MIXED.cu
FILE_MGCG_FULL_V_MIXED := CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_FULL_V_MIXED.cu
FILE_TGCG    := CONJUGATE_GRADIENT_SOLVER_TWO_GRID.cu 
LIB     := -lgsl -lopenblas -lm -lcublas -L$(GSLDIR)/lib -L$(OPENBLASDIR)/lib


all: $(BIN)

MGCG: CONJUGATE_GRADIENT_SOLVER_MULTI_GRID
CONJUGATE_GRADIENT_SOLVER_MULTI_GRID: CONJUGATE_GRADIENT_SOLVER_MULTI_GRID.cu
	$(NVCC) -o CONJUGATE_GRADIENT_SOLVER_MULTI_GRID $(NVFLAGS) $(FILE_MGCG) $(LIB)

#MGCG_SSOR: CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_SSOR
#CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_SSOR: CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_SSOR.cu
#	$(NVCC) -o CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_SSOR $(NVFLAGS) $(FILE_MGCG_SSOR) $(LIB)

TGCG: CONJUGATE_GRADIENT_SOLVER_TWO_GRID
CONJUGATE_GRADIENT_SOLVER_TWO_GRID: CONJUGATE_GRADIENT_SOLVER_TWO_GRID.cu
	$(NVCC) -o CONJUGATE_GRADIENT_SOLVER_TWO_GRID $(NVFLAGS) $(FILE_TGCG) $(LIB)

MGCG_MIXED: CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_MIXED
CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_MIXED: $(FILE_MGCG_MIXED)
	$(NVCC) -o CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_MIXED $(NVFLAGS) $(FILE_MGCG_MIXED) $(LIB)

MGCG_FULL_V_MIXED: CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_FULL_V_MIXED
CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_FULL_V_MIXED: $(FILE_MGCG_FULL_V_MIXED)
	$(NVCC) -o CONJUGATE_GRADIENT_SOLVER_MULTI_GRID_FULL_V_MIXED $(NVFLAGS) $(FILE_MGCG_FULL_V_MIXED) $(LIB)

clean:
	rm -f $(BIN) 
